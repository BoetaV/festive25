{% load custom_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ report_title }}</title>
    <link rel="stylesheet" href="pdf_style.css">
</head>
<body>
    <header>
        <h1>{{ report_title }}</h1>
        <p>Report generated by: <strong>{{ report_user.get_full_name }}</strong> on {% now "d M Y H:i" %}</p>
    </header>

    <main>
        <h2>Overall Summary</h2>
        <table class="summary-table" style="width: 60%;">
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Total Births</td>
                    <td>{{ total_births }}</td>
                </tr>
                <tr>
                    <td>Total Males</td>
                    <td>{{ total_males }}</td>
                </tr>
                <tr>
                    <td>Total Females</td>
                    <td>{{ total_females }}</td>
                </tr>
                <tr>
                    <td>NIL Reports Submitted</td>
                    <td>{{ total_nil_reports }}</td>
                </tr>
            </tbody>
        </table>

        <h2>Breakdown by {{ summary_table_header }}</h2>
        <table class="summary-table">
            <thead>
                <tr>
                    <th>{{ summary_table_header }}</th>
                    <th>Total Babies</th>
                    <th>Males</th>
                    <th>Females</th>
                </tr>
            </thead>
            <tbody>
                {% for summary in summary_data %}
                <tr>
                    <td>{{ summary|get_item:summary_group_by }}</td>
                    <td>{{ summary.total_babies }}</td>
                    <td>{{ summary.male_count }}</td>
                    <td>{{ summary.female_count }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="4" style="text-align: center;">No data found for this selection.</td></tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <th>{{ summary_footer_title }} Total</th>
                    <td>{{ total_births }}</td>
                    <td>{{ total_males }}</td>
                    <td>{{ total_females }}</td>
                </tr>
            </tfoot>
        </table>

        <h2>Births by Mother's Age Group</h2>
        <table class="summary-table">
            <thead>
                <tr>
                    <th>Age Group</th>
                    <th>Males</th>
                    <th>Females</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                {% for group_label, counts in age_group_summary.items %}
                <tr>
                    <td>{{ group_label }}</td>
                    <td>{{ counts.male_count }}</td>
                    <td>{{ counts.female_count }}</td>
                    <td style="font-weight: bold;">{{ counts.total }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="4" style="text-align: center;">No data available for age groups.</td></tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <th>Mother's Age Group - Total</th>
                    <td>{{ total_males }}</td>
                    <td>{{ total_females }}</td>
                    <td>{{ total_births }}</td>
                </tr>
            </tfoot>
        </table>

        <h2>Births by Birth Mode</h2>
        <table class="summary-table">
            <thead>
                <tr>
                    <th>Birth Mode</th>
                    <th>Males</th>
                    <th>Females</th>
                    <th>Total Births</th>
                </tr>
            </thead>
            <tbody>
                {% for summary in birth_mode_summary %}
                <tr>
                    <td>{{ summary.birth_mode }}</td>
                    <td>{{ summary.male_count }}</td>
                    <td>{{ summary.female_count }}</td>
                    <td style="font-weight: bold;">{{ summary.total }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="4" style="text-align: center;">No data available for birth modes.</td></tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <th>Birth Mode - Total</th>
                    <td>{{ total_males }}</td>
                    <td>{{ total_females }}</td>
                    <td>{{ total_births }}</td>
                </tr>
            </tfoot>
        </table>

        <h2>Births per Time Slot</h2>
        <table class="summary-table">
            <thead>
                <tr><th>Time Slot</th><th>Males</th><th>Females</th><th>Total</th></tr>
            </thead>
            <tbody>
                {% for summary in time_slot_summary %}{% if summary.time_slot %}
                <tr><td>{{ summary.time_slot }}</td><td>{{ summary.male_count }}</td><td>{{ summary.female_count }}</td><td style="font-weight: bold;">{{ summary.total_in_slot }}</td></tr>
                {% endif %}{% empty %}
                <tr><td colspan="4" style="text-align: center;">No data available for time slots.</td></tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr><th>Births by Time Slot - Total</th><td>{{ total_males }}</td><td>{{ total_females }}</td><td>{{ total_births }}</td></tr>
            </tfoot>
        </table>

        <h2>Births per Facility Type</h2>
        <table class="summary-table">
            <thead>
                <tr><th>Facility Type</th><th>Males</th><th>Females</th><th>Total</th></tr>
            </thead>
            <tbody>
                {% for summary in facility_type_summary %}{% if summary.facility_type %}
                <tr><td>{{ summary.facility_type }}</td><td>{{ summary.male_count }}</td><td>{{ summary.female_count }}</td><td style="font-weight: bold;">{{ summary.total_in_type }}</td></tr>
                {% endif %}{% empty %}
                <tr><td colspan="4" style="text-align: center;">No data available for facility types.</td></tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr><th>Births by Facility Type - Total</th><td>{{ total_males }}</td><td>{{ total_females }}</td><td>{{ total_births }}</td></tr>
            </tfoot>
        </table>
        
        <h2>Teenage Pregnancies by Facility</h2>
        <table class="summary-table">
            <thead>
                <tr><th>Facility Name</th><th>Births (10-14 yrs)</th><th>Births (15-19 yrs)</th></tr>
            </thead>
            <tbody>
                {% for summary in teenage_pregnancy_summary %}
                    {% if summary.group_10_14 > 0 or summary.group_15_19 > 0 %}
                    <tr><td>{{ summary.facility }}</td><td>{{ summary.group_10_14 }}</td><td>{{ summary.group_15_19 }}</td></tr>
                    {% endif %}
                {% empty %}
                 <tr><td colspan="3" style="text-align: center;">No teenage pregnancy data available for this selection.</td></tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr class="fw-bold">
                    <td>Teenage Pregnancies - Total</td>
                    <td>{{ teenage_totals.total_10_14|default:0 }}</td>
                    <td>{{ teenage_totals.total_15_19|default:0 }}</td>
                </tr>
            </tfoot>
        </table>

         <!-- ============================================= -->
        <!-- NEW: MULTIPLE BIRTHS PER FACILITY TABLE -->
        <!-- ============================================= -->
        <h2>Multiple Births per Facility</h2>
        <table class="summary-table">
            <thead>
                <tr>
                    <th>Facility</th>
                    <th>Twins (Sets)</th>
                    <th>Triplets (Sets)</th>
                    <th>Quadruplets (Sets)</th>
                    <th>Quintuplets (Sets)</th>
                </tr>
            </thead>
            <tbody>
                {% if has_multiple_births %}
                    {% for facility, counts in multiple_births_summary.items %}
                    <tr>
                        <td>{{ facility }}</td>
                        <td>{{ counts.Twins }}</td>
                        <td>{{ counts.Triplets }}</td>
                        <td>{{ counts.Quadruplets }}</td>
                        <td>{{ counts.Quintuplets }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5" style="text-align: center;">No multiple births recorded for this selection.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </main>
</body>
</html>